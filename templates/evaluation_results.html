<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Evaluation Results - CS2 Cheat Detection</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container mt-4">
        <div class="card panel">
            <div class="card-header">
                <h1>üéØ CS2 Cheat Detection Results</h1>
                <p class="mb-0">Comprehensive analysis of {{ results.summary_stats.total_clips }} gameplay clips</p>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <a href="/" class="btn btn-secondary">‚Üê Back to Main</a>
                    <a href="/saved-evaluations" class="btn btn-info">üìÇ View Saved Results</a>
                    <a href="/export-results/{{ process_id }}" class="btn btn-success">üíæ Export as JSON</a>
                </div>

                <div class="alert alert-info">
                    <h4>üìä Understanding Your Results</h4>
                    <p><strong>Confidence Scores (0.0 - 1.0):</strong> Normalized scores where higher values indicate stronger evidence of cheating behavior.</p>
                    <p><strong>Probability Estimates:</strong> Converted using sigmoid transformation to approximate the likelihood of cheating (experimental).</p>
                    <p class="mb-0"><strong>Model Analysis:</strong> Based on {{ results.evaluation_metadata.total_clips_processed }} clips analyzed using Vision Transformer architecture.</p>
                </div>

                <div class="row">
                    <div class="col-md-6 mb-3">
                        <div class="card panel h-100">
                            <div class="card-header"><h3>üìà Score Statistics</h3></div>
                            <div class="card-body">
                                <ul class="list-group list-group-flush">
                                    <li class="list-group-item d-flex justify-content-between align-items-center">Total Clips: <span class="badge badge-primary badge-pill">{{ results.summary_stats.total_clips }}</span></li>
                                    <li class="list-group-item d-flex justify-content-between align-items-center">Average Score: <span>{{ "%.3f"|format(results.summary_stats.mean_score) }}</span></li>
                                    <li class="list-group-item d-flex justify-content-between align-items-center">Median Score: <span>{{ "%.3f"|format(results.summary_stats.median_score) }}</span></li>
                                    <li class="list-group-item d-flex justify-content-between align-items-center">Score Range: <span>{{ "%.3f"|format(results.summary_stats.min_score) }} - {{ "%.3f"|format(results.summary_stats.max_score) }}</span></li>
                                    <li class="list-group-item d-flex justify-content-between align-items-center">Standard Deviation: <span>{{ "%.3f"|format(results.summary_stats.std_score) }}</span></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <div class="card panel h-100">
                            <div class="card-header"><h3>üéØ Confidence Distribution</h3></div>
                            <div class="card-body">
                                <div class="progress mb-2" style="height: 20px;">
                                    <div class="progress-bar bg-danger" role="progressbar" style="width: {{ (results.summary_stats.high_confidence_count / results.summary_stats.total_clips) * 100 }}%" aria-valuenow="{{ results.summary_stats.high_confidence_count }}" aria-valuemin="0" aria-valuemax="{{ results.summary_stats.total_clips }}">High</div>
                                    <div class="progress-bar bg-warning" role="progressbar" style="width: {{ (results.summary_stats.medium_confidence_count / results.summary_stats.total_clips) * 100 }}%" aria-valuenow="{{ results.summary_stats.medium_confidence_count }}" aria-valuemin="0" aria-valuemax="{{ results.summary_stats.total_clips }}">Medium</div>
                                    <div class="progress-bar bg-success" role="progressbar" style="width: {{ (results.summary_stats.low_confidence_count / results.summary_stats.total_clips) * 100 }}%" aria-valuenow="{{ results.summary_stats.low_confidence_count }}" aria-valuemin="0" aria-valuemax="{{ results.summary_stats.total_clips }}">Low</div>
                                </div>
                                <ul class="list-group list-group-flush">
                                    <li class="list-group-item d-flex justify-content-between align-items-center">High Confidence (‚â•0.6): <span class="badge badge-danger badge-pill">{{ results.summary_stats.high_confidence_count }}</span></li>
                                    <li class="list-group-item d-flex justify-content-between align-items-center">Medium Confidence (0.4-0.6): <span class="badge badge-warning badge-pill">{{ results.summary_stats.medium_confidence_count }}</span></li>
                                    <li class="list-group-item d-flex justify-content-between align-items-center">Low Confidence (&lt;0.4): <span class="badge badge-success badge-pill">{{ results.summary_stats.low_confidence_count }}</span></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card panel mb-3">
                    <div class="card-header"><h3>üìä Score Distribution</h3></div>
                    <div class="card-body">
                        <div class="histogram-bars">
                            {% for i in range(results.distribution.bins|length) %}
                            <div class="histogram-bar" style="height: {{ (results.distribution.counts[i] / (results.distribution.counts|max if results.distribution.counts|max > 0 else 1) * 100)|round }}%">
                                <div class="bar-value">{{ results.distribution.counts[i] }}</div>
                                <div class="bar-label">{{ results.distribution.bins[i] }}</div>
                            </div>
                            {% endfor %}
                        </div>
                        <p class="text-center text-muted small mt-2">Distribution of confidence scores across {{ results.summary_stats.total_clips }} clips</p>
                    </div>
                </div>

                <div class="card panel">
                    <div class="card-header"><h3>üé¨ Individual Clip Analysis</h3></div>
                    <div class="table-responsive">
                        <table class="table table-hover table-striped mb-0">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Clip Name</th>
                                    <th>Confidence</th>
                                    <th>Score & Prob.</th>
                                    <th>Category</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for clip in results.clip_results %}
                                <tr class="interactive-row">
                                    <td>#{{ clip.id + 1 }}</td>
                                    <td class="text-monospace">{{ clip.clip_name }}</td>
                                    <td>
                                        <div class="progress" style="height: 8px;">
                                            <div class="progress-bar" role="progressbar" style="width: {{ (clip.normalized_score * 100)|round }}%; background-color: {{ clip.confidence.color }};" aria-valuenow="{{ (clip.normalized_score * 100)|round }}" aria-valuemin="0" aria-valuemax="100"></div>
                                        </div>
                                    </td>
                                    <td class="text-center">
                                        <div><strong>{{ "%.3f"|format(clip.normalized_score) }}</strong></div>
                                        <div class="small text-muted">{{ "%.1f"|format(clip.probability * 100) }}%</div>
                                    </td>
                                    <td class="text-center">
                                        <span class="badge" style="background-color: {{ clip.confidence.color }}; color: white;">{{ clip.confidence.category }}</span>
                                        <div class="small text-muted">{{ clip.confidence.label }}</div>
                                    </td>
                                    <td>
                                        <a href="/clip-analysis/{{ process_id }}/{{ clip.id }}" class="btn btn-primary btn-sm">Analyze</a>
                                        <a href="/serve-video/{{ process_id }}/{{ clip.id }}" class="btn btn-secondary btn-sm" target="_blank">Video</a>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="card panel mt-3">
                    <div class="card-header"><h3>üîß Technical Details</h3></div>
                    <div class="card-body">
                        <ul class="list-group list-group-flush">
                            <li class="list-group-item d-flex justify-content-between align-items-center">Model Used: <span>{{ results.evaluation_metadata.model_path.split('/')[-1] }}</span></li>
                            <li class="list-group-item d-flex justify-content-between align-items-center">Data Source: <span>{{ results.evaluation_metadata.clips_path.split('/')[-1] }}</span></li>
                            <li class="list-group-item d-flex justify-content-between align-items-center">Analysis Time: <span>{{ results.evaluation_metadata.evaluation_timestamp[:19].replace('T', ' ') }}</span></li>
                            <li class="list-group-item d-flex justify-content-between align-items-center">Clips Processed: <span>{{ results.evaluation_metadata.total_clips_processed }}</span></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="{{ url_for('static', filename='main.js') }}"></script>
</body>
</html>